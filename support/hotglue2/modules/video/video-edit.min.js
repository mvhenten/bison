$(document).ready(function(){$(".video").live("glue-upload-dynamic-early",function(d,f,c,b){$(this).children("video").get(0).addEventListener("loadedmetadata",function(k){var g=k.target.videoWidth;var i=k.target.videoHeight;if(typeof g=="number"&&0<g&&typeof i=="number"&&0<i){var j=$(k.target).parent();$(j).css("width",g+"px");$(j).css("height",i+"px");$.glue.object.save(j)}},false);$(this).css("width",$(this).width()+"px");$(this).css("height",$(this).height()+"px");if(f=="center"){$(this).css("left",(c-$(this).outerWidth()/2)+"px");$(this).css("top",(b-$(this).outerHeight()/2)+"px")}else{$(this).css("left",c+"px");$(this).css("top",b+"px")}$(this).css("visibility",$(this).data("orig_visibility"));$(this).removeData("orig_visibility");$.glue.object.register(this);$.glue.object.save(this)});var a=$('<div style="height: 32px; width: 32px;" title="toggle automatic playback of video">');$(a).bind("click",function(d){var c=$(this).data("owner");var b=$(c).children("video").first();if(!$(b).attr("autoplay")){$(b).attr("autoplay","autoplay");$(this).addClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled");$(b).get(0).play()}else{$(b).removeAttr("autoplay");$(this).removeClass("glue-menu-enabled");$(this).addClass("glue-menu-disabled")}$.glue.object.save(c)});$(a).bind("glue-menu-activate",function(d){var c=$(this).data("owner");var b=$(c).children("video").first();if($(b).attr("autoplay")){$("#glue-contextmenu-video-autoplay").addClass("glue-menu-enabled");$("#glue-contextmenu-video-autoplay").removeClass("glue-menu-disabled")}else{$("#glue-contextmenu-video-autoplay").removeClass("glue-menu-enabled");$("#glue-contextmenu-video-autoplay").addClass("glue-menu-disabled")}});$.glue.contextmenu.register("video","video-autoplay",a);a=$('<div style="height: 32px; width: 32px;" title="toggle looping of video">');$(a).bind("click",function(d){var c=$(this).data("owner");var b=$(c).children("video").first();if(!$(b).attr("loop")){$(b).attr("loop","loop");$(this).addClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled")}else{$(b).removeAttr("loop");$(this).removeClass("glue-menu-enabled");$(this).addClass("glue-menu-disabled")}$.glue.object.save(c)});$(a).bind("glue-menu-activate",function(d){var c=$(this).data("owner");var b=$(c).children("video").first();if($(b).attr("loop")){$("#glue-contextmenu-video-loop").addClass("glue-menu-enabled");$("#glue-contextmenu-video-loop").removeClass("glue-menu-disabled")}else{$("#glue-contextmenu-video-loop").removeClass("glue-menu-enabled");$("#glue-contextmenu-video-loop").addClass("glue-menu-disabled")}});$.glue.contextmenu.register("video","video-loop",a);a=$('<div style="height: 32px; width: 32px;" title="show or hide control elements">');$(a).bind("click",function(d){var c=$(this).data("owner");var b=$(c).children("video").first();if(!$(b).attr("controls")){$(b).attr("controls","controls");$(this).addClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled")}else{$(b).removeAttr("controls");$(this).removeClass("glue-menu-enabled");$(this).addClass("glue-menu-disabled")}$.glue.object.save(c)});$(a).bind("glue-menu-activate",function(d){var c=$(this).data("owner");var b=$(c).children("video").first();if($(b).attr("controls")){$("#glue-contextmenu-video-controls").addClass("glue-menu-enabled");$("#glue-contextmenu-video-controls").removeClass("glue-menu-disabled")}else{$("#glue-contextmenu-video-controls").removeClass("glue-menu-enabled");$("#glue-contextmenu-video-controls").addClass("glue-menu-disabled")}});$.glue.contextmenu.register("video","video-controls",a);a=$('<div style="height: 32px; width: 32px;" title="mute or unmute video">');$(a).bind("click",function(d){var c=$(this).data("owner");var b=$(c).children("video").first();if((b).attr("audio")!="muted"){$(b).attr("audio","muted");$(this).addClass("glue-menu-enabled");$(this).removeClass("glue-menu-disabled")}else{$(b).removeAttr("audio");$(this).removeClass("glue-menu-enabled");$(this).addClass("glue-menu-disabled")}$.glue.object.save(c)});$(a).bind("glue-menu-activate",function(d){var c=$(this).data("owner");var b=$(c).children("video").first();if((b).attr("audio")=="muted"){$("#glue-contextmenu-video-mute").addClass("glue-menu-enabled");$("#glue-contextmenu-video-mute").removeClass("glue-menu-disabled")}else{$("#glue-contextmenu-video-mute").removeClass("glue-menu-enabled");$("#glue-contextmenu-video-mute").addClass("glue-menu-disabled")}});$.glue.contextmenu.register("video","video-mute",a);a=$('<img src="'+$.glue.base_url+'modules/video/video-ratio.png" alt="btn" title="reset video size" width="32" height="32">');$(a).bind("glue-menu-activate",function(g){var f=$(this).data("owner");var d=$(f).children("video").first();var b=$(d).get(0).videoWidth;var c=$(d).get(0).videoHeight;if(typeof b=="number"&&0<b&&typeof c=="number"&&0<c){$(this).css("display","block")}else{$(this).css("display","none")}});$(a).bind("click",function(i){var g=$(this).data("owner");var f=$(g).children("video").first();var b=$(f).get(0).videoWidth;var d=$(f).get(0).videoHeight;if(typeof b!="number"||b<=0||typeof d!="number"||d<=0){return}var c=b/d;$(g).trigger("glue-resizestart");$(g).css("width",b+"px");$(g).css("height",d+"px");$(g).trigger("glue-resize");$.glue.object.resizable_update_tooltip(g);$.glue.object.save(g);$(g).trigger("glue-resizestop");$.glue.canvas.update(g)});$.glue.contextmenu.register("video","video-ratio",a);a=$('<img src="'+$.glue.base_url+'img/download.png" alt="btn" title="download original file" width="32" height="32">');$(a).bind("click",function(c){var b=$(this).data("owner");window.location=$.glue.base_url+"?"+$(b).attr("id")+"&download=1"});$.glue.contextmenu.register("video","video-download",a)});
